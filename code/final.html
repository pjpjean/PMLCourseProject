<!DOCTYPE html>
<!-- saved from url=(0014)about:internet -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta http-equiv="x-ua-compatible" content="IE=9" >

<title>Initializing</title>

<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 12px;
   margin: 8px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 { 
   font-size:2.2em; 
}

h2 { 
   font-size:1.8em; 
}

h3 { 
   font-size:1.4em; 
}

h4 { 
   font-size:1.0em; 
}

h5 { 
   font-size:0.9em; 
}

h6 { 
   font-size:0.8em; 
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre {	
   margin-top: 0;
   max-width: 95%;
   border: 1px solid #ccc;
   white-space: pre-wrap;
}

pre code {
   display: block; padding: 0.5em;
}

code.r, code.cpp {
   background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * { 
      background: transparent !important; 
      color: black !important; 
      filter:none !important; 
      -ms-filter: none !important; 
   }

   body { 
      font-size:12pt; 
      max-width:100%; 
   }
       
   a, a:visited { 
      text-decoration: underline; 
   }

   hr { 
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote { 
      padding-right: 1em; 
      page-break-inside: avoid; 
   }

   tr, img { 
      page-break-inside: avoid; 
   }

   img { 
      max-width: 100% !important; 
   }

   @page :left { 
      margin: 15mm 20mm 15mm 10mm; 
   }
     
   @page :right { 
      margin: 15mm 10mm 15mm 20mm; 
   }

   p, h2, h3 { 
      orphans: 3; widows: 3; 
   }

   h2, h3 { 
      page-break-after: avoid; 
   }
}

</style>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: rgb(88, 72, 246)
   }

   pre .number {
     color: rgb(0, 0, 205);
   }

   pre .comment {
     color: rgb(76, 136, 107);
   }

   pre .keyword {
     color: rgb(0, 0, 255);
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: rgb(3, 106, 7);
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>




</head>

<body>
<h1>Initializing</h1>

<pre><code class="r">library(caret)
library(ggplot2)
library(randomForest)
source(wd(&quot;code\\utils.R&quot;))
</code></pre>

<h1>Read datasets</h1>

<pre><code class="r">pml &lt;- read.csv(wd(&quot;data/pml-training.csv&quot;), stringsAsFactors = FALSE, na.strings = c(&quot;&quot;, 
    &quot;NA&quot;, &quot;#DIV/0!&quot;))
pml.submit &lt;- read.csv(wd(&quot;data/pml-testing.csv&quot;), stringsAsFactors = FALSE, 
    na.strings = c(&quot;&quot;, &quot;NA&quot;, &quot;#DIV/0!&quot;))
</code></pre>

<h1>Examining variables</h1>

<pre><code class="r">table(sapply(pml, class))
</code></pre>

<pre><code>## 
## character   integer   logical   numeric 
##         4        35         6       115
</code></pre>

<pre><code class="r"># check strings
head(classSubset(pml, &quot;character&quot;))
</code></pre>

<pre><code>##   user_name   cvtd_timestamp new_window classe
## 1  carlitos 05/12/2011 11:23         no      A
## 2  carlitos 05/12/2011 11:23         no      A
## 3  carlitos 05/12/2011 11:23         no      A
## 4  carlitos 05/12/2011 11:23         no      A
## 5  carlitos 05/12/2011 11:23         no      A
## 6  carlitos 05/12/2011 11:23         no      A
</code></pre>

<pre><code class="r"># check logicals
summary(classSubset(pml, &quot;logical&quot;))
</code></pre>

<pre><code>##  kurtosis_yaw_belt skewness_yaw_belt kurtosis_yaw_dumbbell
##  Mode:logical      Mode:logical      Mode:logical         
##  NA&#39;s:19622        NA&#39;s:19622        NA&#39;s:19622           
##  skewness_yaw_dumbbell kurtosis_yaw_forearm skewness_yaw_forearm
##  Mode:logical          Mode:logical         Mode:logical        
##  NA&#39;s:19622            NA&#39;s:19622           NA&#39;s:19622
</code></pre>

<pre><code class="r"># will remove all variables with more than 90% NA&#39;s
na.count &lt;- sapply(pml, function(x) sum(is.na(x)))
na.count[na.count/nrow(pml) &gt; 0.9]
</code></pre>

<pre><code>##       kurtosis_roll_belt      kurtosis_picth_belt        kurtosis_yaw_belt 
##                    19226                    19248                    19622 
##       skewness_roll_belt     skewness_roll_belt.1        skewness_yaw_belt 
##                    19225                    19248                    19622 
##            max_roll_belt           max_picth_belt             max_yaw_belt 
##                    19216                    19216                    19226 
##            min_roll_belt           min_pitch_belt             min_yaw_belt 
##                    19216                    19216                    19226 
##      amplitude_roll_belt     amplitude_pitch_belt       amplitude_yaw_belt 
##                    19216                    19216                    19226 
##     var_total_accel_belt            avg_roll_belt         stddev_roll_belt 
##                    19216                    19216                    19216 
##            var_roll_belt           avg_pitch_belt        stddev_pitch_belt 
##                    19216                    19216                    19216 
##           var_pitch_belt             avg_yaw_belt          stddev_yaw_belt 
##                    19216                    19216                    19216 
##             var_yaw_belt            var_accel_arm             avg_roll_arm 
##                    19216                    19216                    19216 
##          stddev_roll_arm             var_roll_arm            avg_pitch_arm 
##                    19216                    19216                    19216 
##         stddev_pitch_arm            var_pitch_arm              avg_yaw_arm 
##                    19216                    19216                    19216 
##           stddev_yaw_arm              var_yaw_arm        kurtosis_roll_arm 
##                    19216                    19216                    19294 
...
</code></pre>

<pre><code class="r">summary(na.count)
</code></pre>

<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##       0       0   19200   12000   19200   19600
</code></pre>

<pre><code class="r">hist(na.count)
</code></pre>

<p><img src="data:image/png;base64,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" alt="plot of chunk examine-variables"/> </p>

<pre><code class="r">hist(na.count[na.count/nrow(pml) &gt; 0.9])
</code></pre>

<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfgAAAH4CAMAAACR9g9NAAAApVBMVEX9/v0AAAAAADkAAGUAOTkAOWUAOY8AZo8AZrU5AAA5ADk5AGU5OTk5OWU5OY85ZmU5ZrU5j485j7U5j9plAABlADllAGVlOQBlOY9lZjllZmVlj49ltbVltf2POQCPOTmPOWWPZgCPjzmPj2WPtY+P29qP2/21ZgC1Zjm1tWW124+1/rW1/v3ajzna24/a/rXa/tra/v39tWX924/9/rX9/tr9/v21dubgAAAAN3RSTlP///////////////////////////////////////////////////////////////////////8AEFmdiwAAAAlwSFlzAAALEgAACxIB0t1+/AAADrJJREFUeJztnYmW4sYZRq3GJjATdxaYnkxiaCd2IJOB2C2W93+01CqkRoCE1Evx3XvODLQo/SrpqjahEt/tQZLv3joD8DYgXhTEi4J4URAvCuJFQbwoiBcF8aIgXhTEi4J4URAvCuJFQbwoiBcF8aIgXhTEi4J4URAvCuJFQbwoiBcF8aK8gvjtdLDa73fzwcq/iyxnHYJuxtndolO2zOZ38ywbdYpg/hs+NUm7PpFbe0g240nNJ+XMbafu/TLLmm2tAa8qvrJ4mXUR323tEKCbeJeF3bxO2hHb6YntuIOzDIdmXY5lLMfcWe9ZNklXvHtnymo2WNljbndr7fbInd+Db9Ph025+98WU5dwsNmUkz/5glq9MoqjZp3dru2Ngwn618fb7sIrDfu4OZgjvzrqtC++T+827xZ0imL2ZFQFC3os8mkVr88autXanWUhX3it3SPJsEneuELsZH2rI3GyoyEBPVl5dvD97h7/74+ZOa7db5uX7sT2u9tPffKKnPIuEMhHSl8WHCCGuOy5+oS1KRfhCWylAFN8hwj4Pp0CxE8OnuIqVvbRJsok5JRZxQ9W9cgen8Jkf9jR3dbs/D7148z418eW93IxD3m1NuRm7vblb2PPbHCl3XEdxtcEqz+wK2cwmscuK9EVVb9JPzIHxMWMJcdFMiiJ5WVtI7qt6L/76CLaJL5b4vJf2abKd/t2U7LuFE+bSmYMxK++V22CpGbRnh9szVwuEvQxHcJa0ePeX3U+7U+60tkXDvfHH1Su2yaz4kXMRlxbpS+KLguBX8cl81Vkk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" alt="plot of chunk examine-variables"/> </p>

<pre><code class="r">table(na.count)
</code></pre>

<pre><code>## na.count
##     0 19216 19217 19218 19220 19221 19225 19226 19227 19248 19293 19294 
##    60    67     1     1     1     4     1     4     2     2     1     1 
## 19296 19299 19300 19301 19622 
##     2     1     4     2     6
</code></pre>

<pre><code class="r">table(na.count[na.count/nrow(pml) &gt; 0.9])
</code></pre>

<pre><code>## 
## 19216 19217 19218 19220 19221 19225 19226 19227 19248 19293 19294 19296 
##    67     1     1     1     4     1     4     2     2     1     1     2 
## 19299 19300 19301 19622 
##     1     4     2     6
</code></pre>

<pre><code class="r"># it seems that num_window is an id
table(pml$user_name, pml$num_window)
</code></pre>

<pre><code>##           
##             1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21
##   adelmo    0  0  0 28 21 21 21 24 24 12  0  0  0  0  0  0  0  0  0  0  0
##   carlitos  0  0  0  0  0  0  0  0  0  0  3 21 28 24 24 29 17 19 21 28 23
##   charles   0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
##   eurico   20 21  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
##   jeremy    0  0  3  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
##   pedro     0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
##           
##            22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42
##   adelmo    0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
##   carlitos 20 32 22  1 28 15 34 35 27 30 20 17 22 30 29 28 18 25 28 25 24
##   charles   0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
##   eurico    0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
##   jeremy    0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
##   pedro     0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
##           
##            43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63
##   adelmo    0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
##   carlitos 33 22 17  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
##   charles   0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
##   eurico    0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
##   jeremy    0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
##   pedro     0  0  0 17 28 31 18 35 20 15 32 18 22 24 38 13 30 26 20 29 17
...
</code></pre>

<pre><code class="r">nrow(unique(pml[c(&quot;user_name&quot;, &quot;num_window&quot;)]))
</code></pre>

<pre><code>## [1] 858
</code></pre>

<pre><code class="r">length(unique(pml$num_window))
</code></pre>

<pre><code>## [1] 858
</code></pre>

<h1>Some transformations</h1>

<pre><code class="r"># transform some variables
pml &lt;- within(pml, {
    classe &lt;- factor(classe)
    new_window &lt;- as.numeric(new_window == &quot;yes&quot;)  # convert to logic (0 or 1)
})
pml.submit &lt;- within(pml.submit, {
    # classe &lt;- factor(classe, levels = levels(pml$classe))
    new_window &lt;- as.numeric(new_window == &quot;yes&quot;)  # convert to logic (0 or 1)
})
table(sapply(pml, class))
</code></pre>

<pre><code>## 
## character    factor   integer   logical   numeric 
##         2         1        35         6       116
</code></pre>

<pre><code class="r"># head(pml, 1)
</code></pre>

<p>this data would likely benefit of time series analysis since activities
have a logical connection (suggested variables: previous_activity, etc.)
Unfortunately, test set observations are isolated cases and thus have no
time series context (well, technically they have, because they have
timestamp, num_window, etc., but as they are isolated, they shouldn&#39;t)</p>

<p>user_name, otherwise, although is not informative as such, might
give us indirect information on age, height, weigth of our subjects.
user_name is a proxy for age, height, weigth &hellip;</p>

<h2>Tidy dataset</h2>

<pre><code class="r"># categorize variables
id.vars &lt;- c(&quot;X&quot;, &quot;num_window&quot;)
rem.vars &lt;- c(&quot;raw_timestamp_part_1&quot;, &quot;raw_timestamp_part_2&quot;, &quot;cvtd_timestamp&quot;)
na.vars &lt;- names(which(sapply(pml, function(x) sum(is.na(x))/length(x)) &gt; 0.9))
y.var &lt;- &quot;classe&quot;
x.vars &lt;- names(pml)[!names(pml) %in% c(id.vars, rem.vars, na.vars, y.var)]
d.vars &lt;- c(x.vars, y.var)
</code></pre>

<h1>Split dataset</h1>

<p>We&#39;ll divide the dataset in two: training and test set.
training will be used to train the models and tuning will be done with cross-validation (or, in the case of random forest, with out-of-bag estimation)
test will be used to estimate each model&#39;s performance.</p>

<pre><code class="r">set.seed(40187)
inTrain &lt;- createDataPartition(pml$classe, p = 0.7, list = FALSE)
pml.train &lt;- pml[inTrain, d.vars]
pml.test &lt;- pml[-inTrain, d.vars]
</code></pre>

<pre><code class="r">print.cor(cor(classSubset(pml.train, c(&quot;numeric&quot;, &quot;integer&quot;))), min.coef = 0.6, 
    lower.t = TRUE)
</code></pre>

<pre><code>##                   roll_belt pitch_belt yaw_belt total_accel_belt
## yaw_belt               0.82      -0.71        .                .
## total_accel_belt       0.98          .     0.76                .
## accel_belt_x              .      -0.97     0.71                .
## accel_belt_y           0.93          .     0.61             0.94
## accel_belt_z          -0.99          .    -0.78            -0.98
## magnet_belt_x             .      -0.92     0.77                .
## accel_arm_y           -0.79          .    -0.67            -0.76
## yaw_dumbbell              .       0.67        .                .
##                   gyros_belt_x accel_belt_x accel_belt_y accel_belt_z
## accel_belt_z                 .            .        -0.94            .
## magnet_belt_x                .         0.92            .            .
## accel_arm_y                  .            .        -0.73         0.78
## yaw_dumbbell                 .        -0.66            .            .
## magnet_dumbbell_x        -0.76            .            .            .
## magnet_dumbbell_y         0.81            .            .            .
##                   magnet_belt_x magnet_belt_y total_accel_arm gyros_arm_x
## magnet_belt_z                 .          0.85               .           .
## gyros_arm_y                   .             .               .       -0.92
## accel_arm_z                   .             .           -0.61           .
## yaw_dumbbell              -0.64             .               .           .
##                   accel_arm_x accel_arm_z magnet_arm_x magnet_arm_y
## magnet_arm_x             0.81           .            .            .
## magnet_arm_y            -0.70           .        -0.78            .
## magnet_arm_z            -0.66        0.79            .         0.81
##                   roll_dumbbell pitch_dumbbell yaw_dumbbell
## accel_dumbbell_x              .           0.79            .
## accel_dumbbell_y           0.72              .            .
## accel_dumbbell_z              .              .         0.85
##                   total_accel_dumbbell gyros_dumbbell_x accel_dumbbell_x
## gyros_dumbbell_z                     .            -0.62                .
## accel_dumbbell_x                 -0.66                .                .
## accel_dumbbell_y                  0.79                .                .
## accel_dumbbell_z                 -0.63                .              0.7
##                   accel_dumbbell_y magnet_dumbbell_x magnet_dumbbell_z
## accel_dumbbell_z             -0.67                 .                 .
## magnet_dumbbell_y                .             -0.77                 .
## accel_forearm_z                  .                 .              0.62
## magnet_forearm_z                 .                 .             -0.60
##                   gyros_forearm_y accel_forearm_x accel_forearm_y
## gyros_forearm_z              0.74               .               .
## magnet_forearm_x                .            0.68               .
## magnet_forearm_y                .               .            0.75
</code></pre>

<pre><code class="r">if (draft) {
    default.trControl &lt;- trainControl(method = &quot;cv&quot;, number = 10)
} else {
    default.trControl &lt;- trainControl(method = &quot;repeatedcv&quot;, number = 10, repeats = 3)
}
</code></pre>

<pre><code class="r">set.seed(43443)
mnom.trControl &lt;- default.trControl
mnom.time &lt;- system.time(mnom.basemodel &lt;- train(classe ~ ., data = pml.train, 
    method = &quot;multinom&quot;, trControl = mnom.trControl, tuneLength = 5))
</code></pre>

<pre><code class="r">mnom.time
</code></pre>

<pre><code>##    user  system elapsed 
##   57.05    0.04   57.10
</code></pre>

<pre><code class="r">mnom.basemodel
</code></pre>

<pre><code>## Penalized Multinomial Regression 
## 
## 1373 samples
##   54 predictor
##    5 classes: &#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;, &#39;E&#39; 
## 
## No pre-processing
## Resampling: Cross-Validated (10 fold) 
## 
## Summary of sample sizes: 1235, 1235, 1236, 1237, 1234, 1237, ... 
## 
## Resampling results across tuning parameters:
## 
##   decay  Accuracy  Kappa  Accuracy SD  Kappa SD
##   0e+00  0.6       0.6    0.05         0.06    
##   1e-04  0.6       0.6    0.05         0.06    
##   1e-03  0.6       0.6    0.05         0.06    
##   1e-02  0.6       0.6    0.05         0.06    
##   1e-01  0.6       0.6    0.05         0.06    
## 
## Accuracy was used to select the optimal model using  the largest value.
## The final value used for the model was decay = 0.1.
</code></pre>

<pre><code class="r">t(coef(mnom.basemodel$finalModel))
</code></pre>

<pre><code>##                               B          C          D          E
## (Intercept)          -1.704e-03  9.217e-04  3.200e-03  8.416e-04
## user_namecarlitos    -3.549e-03  1.331e-02 -5.397e-03  1.569e-02
## user_namecharles     -3.887e-03  7.857e-04  5.471e-03  1.388e-03
## user_nameeurico      -3.823e-03 -3.334e-03  3.254e-03 -7.217e-03
## user_namejeremy       5.336e-03 -1.165e-02 -3.046e-05  4.636e-03
## user_namepedro       -3.234e-03  7.538e-05  1.473e-03  8.238e-04
## new_window            2.243e-02 -2.978e-03  2.087e-03 -8.417e-03
## roll_belt             1.281e-01  8.689e-02 -8.049e-02  1.420e-01
## pitch_belt           -2.611e-01 -9.409e-02 -9.274e-02  2.507e-01
## yaw_belt             -1.044e-01 -9.541e-02 -7.871e-02 -2.321e-02
## total_accel_belt     -1.866e-01 -4.382e-02  1.929e-01 -2.926e-03
## gyros_belt_x         -4.816e-03 -2.106e-03  4.246e-03  6.444e-03
## gyros_belt_y          1.118e-03  2.400e-03 -3.018e-03 -2.029e-03
## gyros_belt_z          7.375e-03 -1.868e-02 -1.746e-02  4.975e-02
## accel_belt_x          8.303e-02  3.029e-02  1.113e-02  4.774e-02
## accel_belt_y          2.368e-02 -2.272e-02 -4.958e-03 -1.774e-01
## accel_belt_z          3.043e-04 -4.392e-02 -7.916e-02 -1.562e-03
## magnet_belt_x        -6.666e-02 -1.134e-02 -4.318e-03 -4.092e-03
## magnet_belt_y        -1.278e-03 -1.186e-03 -3.801e-03 -1.662e-02
## magnet_belt_z         1.456e-02  3.344e-02  2.102e-02  8.270e-03
## roll_arm              6.499e-03  1.734e-03  1.482e-03  1.468e-03
## pitch_arm             1.667e-02  9.093e-04 -5.674e-03 -1.539e-03
## yaw_arm               2.406e-03  4.049e-03  5.889e-03 -3.341e-05
## total_accel_arm      -3.496e-02 -1.416e-02  7.345e-02  9.652e-03
## gyros_arm_x           8.297e-02 -6.731e-02  2.146e-03  2.360e-01
## gyros_arm_y          -5.177e-02  5.483e-02  3.193e-03 -8.427e-02
## gyros_arm_z          -2.278e-02  1.997e-02  9.442e-03  1.280e-02
## accel_arm_x          -1.615e-02 -8.373e-03  1.301e-03 -1.522e-02
## accel_arm_y          -1.285e-02 -1.005e-02 -2.732e-02 -1.288e-02
## accel_arm_z           1.990e-02  5.663e-03  1.851e-02  2.547e-02
## magnet_arm_x          5.907e-03  1.823e-03  1.361e-03  2.148e-03
## magnet_arm_y          1.555e-02  3.639e-03  4.806e-04 -4.137e-03
## magnet_arm_z         -1.810e-02 -2.502e-03 -1.273e-04 -8.883e-03
## roll_dumbbell         1.521e-03  6.873e-04  1.545e-02  2.836e-03
## pitch_dumbbell       -6.457e-03 -5.799e-03  7.355e-04 -6.756e-03
## yaw_dumbbell         -1.535e-02 -1.326e-02 -1.830e-02 -1.221e-02
## total_accel_dumbbell  1.575e-01 -9.143e-03  2.588e-02  2.497e-01
## gyros_dumbbell_x      1.346e-05  7.580e-03  1.592e-02 -1.166e-02
## gyros_dumbbell_y     -1.699e-02  1.509e-02  2.615e-02  2.416e-02
## gyros_dumbbell_z      1.805e-02 -1.532e-02  1.290e-02 -2.793e-03
## accel_dumbbell_x      1.482e-02  9.700e-03  6.832e-03  4.481e-02
## accel_dumbbell_y      6.168e-03  3.483e-03  1.923e-03  8.012e-03
## accel_dumbbell_z      1.376e-02  2.847e-03  2.680e-03  5.900e-03
## magnet_dumbbell_x    -2.376e-03 -7.520e-03 -5.358e-03 -1.259e-02
## magnet_dumbbell_y    -2.744e-03 -8.166e-03 -5.111e-03 -7.521e-03
## magnet_dumbbell_z     6.680e-03  3.838e-02  3.014e-02  2.504e-02
## roll_forearm          1.879e-03 -1.118e-03 -1.793e-03 -2.572e-04
## pitch_forearm         1.931e-02  8.283e-03  4.073e-02  4.677e-02
## yaw_forearm          -4.472e-04 -1.116e-03 -1.136e-03 -3.919e-04
## total_accel_forearm   7.580e-02  4.210e-03  2.090e-02  1.130e-01
## gyros_forearm_x       2.485e-02  1.070e-02 -2.170e-02 -5.882e-02
## gyros_forearm_y      -6.260e-02 -4.619e-02  2.075e-02  4.605e-02
## gyros_forearm_z       7.339e-03 -2.042e-02 -4.330e-03  1.586e-02
## accel_forearm_x       6.026e-03 -1.160e-03 -9.649e-03  1.150e-02
## accel_forearm_y      -7.156e-04  1.977e-03  2.016e-03 -4.806e-04
## accel_forearm_z       2.681e-03 -1.469e-02 -9.987e-03 -1.078e-02
## magnet_forearm_x     -1.889e-03 -2.054e-04  1.670e-03 -4.329e-03
## magnet_forearm_y     -8.562e-04  4.021e-05  8.863e-04 -8.830e-04
## magnet_forearm_z      2.861e-04  1.901e-03  6.297e-04  3.166e-03
</code></pre>

<pre><code class="r">num.vars &lt;- classVars(pml.train, c(&quot;numeric&quot;, &quot;integer&quot;))
cor.vars &lt;- num.vars[findCorrelation(cor(classSubset(pml.train, c(&quot;numeric&quot;, 
    &quot;integer&quot;))), cutoff = 0.75)]
lowcor.vars &lt;- names(pml.train)[!d.vars %in% cor.vars]
mnom.lowcortime &lt;- system.time(mnom.lowcormodel &lt;- train(classe ~ ., data = pml.train[, 
    lowcor.vars], method = &quot;multinom&quot;, trControl = mnom.trControl, tuneLength = 5))
</code></pre>

<pre><code class="r">mnom.lowcortime
</code></pre>

<pre><code>##    user  system elapsed 
##   42.02    0.05   42.18
</code></pre>

<pre><code class="r">mnom.lowcormodel
</code></pre>

<pre><code>## Penalized Multinomial Regression 
## 
## 1373 samples
##   36 predictor
##    5 classes: &#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;, &#39;E&#39; 
## 
## No pre-processing
## Resampling: Cross-Validated (10 fold) 
## 
## Summary of sample sizes: 1236, 1235, 1235, 1236, 1236, 1235, ... 
## 
## Resampling results across tuning parameters:
## 
##   decay  Accuracy  Kappa  Accuracy SD  Kappa SD
##   0e+00  0.5       0.4    0.04         0.05    
##   1e-04  0.5       0.4    0.04         0.05    
##   1e-03  0.5       0.4    0.04         0.05    
##   1e-02  0.5       0.4    0.04         0.05    
##   1e-01  0.5       0.4    0.04         0.05    
## 
## Accuracy was used to select the optimal model using  the largest value.
## The final value used for the model was decay = 0.01.
</code></pre>

<pre><code class="r">mnom.lowcormodel$finalModel
</code></pre>

<pre><code>## Call:
## multinom(formula = .outcome ~ ., data = dat, decay = param$decay)
## 
## Coefficients:
##   (Intercept) user_namecarlitos user_namecharles user_nameeurico
## B    -0.35780            0.3604           1.6436         -1.3346
## C    -0.36892           -0.3658           0.1635         -0.3008
## D     0.08313           -0.9837          -0.8099          0.5454
## E     0.72535            3.6858           2.1498         -0.6936
##   user_namejeremy user_namepedro new_window pitch_belt total_accel_belt
## B         -0.3015        -0.6377    0.90646    0.01984          0.17632
## C         -0.6382         0.3832   -0.01668    0.02995          0.10648
## D          0.3999         1.0188   -0.08722    0.02036          0.02684
## E         -0.9251        -2.6875    0.07525    0.06863          0.39686
##   gyros_belt_x gyros_belt_y gyros_belt_z magnet_belt_y  roll_arm pitch_arm
## B    -0.085595       0.3999       0.6978     -0.006745  0.007230  0.012027
## C    -0.005689       0.2693      -0.3928     -0.007470  0.002581 -0.001572
## D    -0.416638      -0.3633      -1.0131     -0.015557 -0.001041 -0.001591
## E     1.694552      -0.1198       1.3306     -0.021553  0.003085 -0.002889
##    yaw_arm total_accel_arm gyros_arm_x gyros_arm_z magnet_arm_x
## B 0.007861       -0.039247     0.02431    -0.38804   -8.396e-04
## C 0.003130       -0.002747    -0.15590     0.55203    7.796e-05
## D 0.004087        0.078757    -0.13256     0.25521    2.678e-03
## E 0.001064       -0.014523     0.04923    -0.01063    8.279e-05
##   magnet_arm_z roll_dumbbell pitch_dumbbell yaw_dumbbell
## B   -0.0041979      0.004164      0.0068498    -0.004524
## C    0.0011593     -0.004535     -0.0006552    -0.016279
## D    0.0024217      0.017844     -0.0072530    -0.011987
## E   -0.0008554      0.002289     -0.0060472    -0.011003
##   total_accel_dumbbell gyros_dumbbell_x gyros_dumbbell_y gyros_dumbbell_z
## B              0.09263          -0.5161           0.3736           0.6684
## C             -0.04879          -0.4725           0.5279           0.2761
## D             -0.14990           0.3285           0.9302           0.9097
## E              0.12706          -0.7256           0.4589           0.4445
##   magnet_dumbbell_z roll_forearm pitch_forearm yaw_forearm
## B           0.01063     0.003212       0.03696   -0.003156
## C           0.02131     0.001678       0.02880   -0.003773
## D           0.02158     0.002711       0.04880   -0.005539
## E           0.02036     0.007210       0.05155   -0.001514
##   total_accel_forearm gyros_forearm_x gyros_forearm_y gyros_forearm_z
## B             0.07329         -0.4054       -0.079768        -0.02695
## C             0.01628         -0.3363       -0.001626        -0.20109
## D             0.06262         -0.5115       -0.075290        -0.15950
## E             0.12035         -0.5984       -0.054835         0.15747
##   accel_forearm_x accel_forearm_z magnet_forearm_x magnet_forearm_y
## B        0.002645       -0.002199       -0.0012913        -0.000876
## C       -0.005305       -0.014583        0.0004504         0.001188
## D       -0.014468       -0.014793        0.0030090         0.002043
## E        0.007371       -0.007617       -0.0029237        -0.001049
##   magnet_forearm_z
## B       -0.0002339
## C        0.0018327
## D        0.0021965
## E       -0.0006916
## 
## Residual Deviance: 2896 
## AIC: 3224
</code></pre>

<h2>random forest</h2>

<p>In random forests, there is no need for cross-validation or a separate test
set to get an unbiased estimate of the test set error. It is estimated
internally, during the run, as follows:</p>

<pre><code class="r">set.seed(43443)
rf.trControl &lt;- trainControl(method = &quot;oob&quot;)
rf.time &lt;- system.time(rf.basemodel &lt;- train(classe ~ ., data = pml.train, method = &quot;rf&quot;, 
    trControl = rf.trControl, tuneLength = 5))
</code></pre>

<pre><code class="r">rf.time
</code></pre>

<pre><code>##    user  system elapsed 
##   37.42    0.13   37.66
</code></pre>

<pre><code class="r">rf.basemodel
</code></pre>

<pre><code>## Random Forest 
## 
## 1373 samples
##   54 predictor
##    5 classes: &#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;, &#39;E&#39; 
## 
## No pre-processing
## Resampling: Out of Bag Resampling 
## 
## Summary of sample sizes:  
## 
## Resampling results across tuning parameters:
## 
##   mtry  Accuracy  Kappa
##    2    0.9       0.9  
##   16    0.9       0.9  
##   30    0.9       0.9  
##   44    0.9       0.9  
##   58    0.9       0.9  
## 
## Accuracy was used to select the optimal model using  the largest value.
## The final value used for the model was mtry = 16.
</code></pre>

<pre><code class="r">rf.basemodel$finalModel
</code></pre>

<pre><code>## 
## Call:
##  randomForest(x = x, y = y, mtry = param$mtry) 
##                Type of random forest: classification
##                      Number of trees: 500
## No. of variables tried at each split: 16
## 
##         OOB estimate of  error rate: 6.7%
## Confusion matrix:
##     A   B   C   D   E class.error
## A 398   2   1   1   0     0.00995
## B  20 233  14   0   2     0.13383
## C   0  13 234   2   1     0.06400
## D   2   2  15 184   0     0.09360
## E   1   6   5   5 232     0.06827
</code></pre>

<pre><code class="r"># pred.basemodel &lt;- predict(rf.basemodel,newdata = pml.validation)
# confusionMatrix(pml.validation$classe, pred.basemodel)
varImp(rf.basemodel)
</code></pre>

<pre><code>## rf variable importance
## 
##   only 20 most important variables shown (out of 58)
## 
##                      Overall
## roll_belt              100.0
## pitch_forearm           76.2
## magnet_dumbbell_z       61.1
## yaw_belt                56.1
## magnet_dumbbell_y       54.6
## pitch_belt              41.7
## roll_forearm            39.4
## roll_dumbbell           34.9
## magnet_dumbbell_x       33.1
## accel_dumbbell_y        31.8
## accel_belt_z            29.9
## gyros_belt_z            29.2
## magnet_belt_z           28.6
## accel_forearm_x         27.0
## magnet_belt_y           23.2
## gyros_dumbbell_y        22.8
## total_accel_dumbbell    21.9
## accel_dumbbell_z        21.1
## magnet_forearm_z        19.1
## yaw_dumbbell            18.4
</code></pre>

<pre><code class="r"># pml_write_files(as.character(predict(rf.basemodel, newdata=pml.submit)),
# &#39;rf-mtry_16&#39;)
</code></pre>

<pre><code class="r">set.seed(43443)
svm.trControl &lt;- default.trControl
svm.time &lt;- system.time(svm.basemodel &lt;- train(classe ~ ., data = pml.train, 
    method = &quot;svmRadialCost&quot;, preProc = c(&quot;center&quot;, &quot;scale&quot;), trControl = svm.trControl, 
    tuneLength = 9))
</code></pre>

<pre><code class="r">svm.time
</code></pre>

<pre><code>##    user  system elapsed 
##   89.25    0.40   89.88
</code></pre>

<pre><code class="r">svm.basemodel
</code></pre>

<pre><code>## Support Vector Machines with Radial Basis Function Kernel 
## 
## 1373 samples
##   54 predictor
##    5 classes: &#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;, &#39;E&#39; 
## 
## Pre-processing: centered, scaled 
## Resampling: Cross-Validated (10 fold) 
## 
## Summary of sample sizes: 1235, 1235, 1236, 1237, 1234, 1237, ... 
## 
## Resampling results across tuning parameters:
## 
##   C     Accuracy  Kappa  Accuracy SD  Kappa SD
##    0.2  0.6       0.4    0.03         0.04    
##    0.5  0.7       0.6    0.04         0.05    
##    1.0  0.8       0.7    0.04         0.05    
##    2.0  0.8       0.7    0.03         0.04    
##    4.0  0.8       0.8    0.03         0.04    
##    8.0  0.9       0.8    0.02         0.03    
##   16.0  0.9       0.9    0.02         0.03    
##   32.0  0.9       0.9    0.02         0.03    
##   64.0  0.9       0.9    0.02         0.03    
## 
## Accuracy was used to select the optimal model using  the largest value.
## The final value used for the model was C = 64.
</code></pre>

<pre><code class="r">svm.basemodel$finalModel
</code></pre>

<pre><code>## Support Vector Machine object of class &quot;ksvm&quot; 
## 
## SV type: C-svc  (classification) 
##  parameter : cost C = 64 
## 
## Gaussian Radial Basis kernel function. 
##  Hyperparameter : sigma =  0.010811317246045 
## 
## Number of Support Vectors : 926 
## 
## Objective Function Value : -1724 -915.2 -697.5 -360.8 -1192 -385.2 -559.1 -1722 -797.8 -623.7 
## Training error : 0.005827
</code></pre>

<pre><code class="r">sel.models &lt;- list(mnom = mnom.basemodel, mnom.lc = mnom.lowcormodel, rf = rf.basemodel, 
    svm = svm.basemodel)
test.pred &lt;- predict(sel.models, newdata = pml.test)
t(sapply(test.pred, pml.test$classe, FUN = function(pred, obs) {
    cm &lt;- confusionMatrix(pred, obs)
    round(cm$overall[1:4] * 100, 1)
}))
</code></pre>

<pre><code>##         Accuracy Kappa AccuracyLower AccuracyUpper
## mnom        64.3  54.6          60.3          68.2
## mnom.lc     55.3  43.1          51.2          59.3
## rf          93.5  91.8          91.2          95.4
## svm         88.3  85.1          85.4          90.8
</code></pre>

</body>

</html>

